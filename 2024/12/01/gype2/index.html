<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Hexo</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/font-awesome.min.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="wrap"><nav class="page-navigation"><div class="nav-container"><div class="page-header-logo"><h1 class="prince-log"><a href="/" class="home-link">Hello</a></h1></div><button type="button" data-toggle="collapse" data-target=".main-nav-items" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><ul class="collapse navbar-collapse main-nav-items"><li class="menu-item"><a href="/" target="_self">HOME</a></li><li class="menu-item"><a href="/archives/" target="_self">ARCHIVE</a></li></ul></div></nav><main class="prince-container"><div class="post"><article class="post-block"><h1 class="post-title">关于PE结构2</h1><div class="post-info">Dec 1st 2024</div><div class="post-entry"><p>其他的一些概念知识<br>o<br>1.PE的结构的部分空间会存在空白是因为PE结构内部的储存空间就像一本书，书里有好多张二维的纸即页，PE文件被PE转载器映射到内存时，每页纸都会等比例变大，这也是到内存后偏移地址之间大小比例不变，但它们大小会发生变化的原因，而产生空白的原因就像我们记笔记时，每记一部分结束后，下一部分从下一页头部开始写，于是一部分的尾部，到下一页的头部就会变成了空白<br>o<br>2.当电脑执行PE文件时，采用与内存映射文件类似的机制，PE装载器仅建立和虚拟地址和PE文件的映射关系，请真正执行到某页数据时，这也才会从外存到内存，且其装入速度与文件大小无关<br>o<br>3.与内存映射文件不同的是装在不相映射那样完全照开可能会有预处理重定位，正因此，装入数据的相对位置可能等比例的变化<br>o<br>4.PE装载器不对两头和区块表做特殊处理，但到了区块会根据不同情况做不同的处理，如内存页属性、节的偏移地址、节的尺寸<br>o<br>5.节的本质是相同属性数据的组合，节对应的内存页都被赋予相同的属性，节在内存中的对齐单位至少是一个页大小<br>o<br>o<br>关于得到硬盘rva的方法<br>o<br>任何rva必须经过到文件偏移的换算才能用来定位并访问该数据<br>o<br>1.首先，我们根据 virtualaddress字段、得出每个区块在内存中起始的rva<br>o<br>2.根据区块大小（sizeofrawdata字段）算出结束的rva（两者相加）<br>o<br>3.判断目标rva是否落在该区块内<br>o<br>4.用目标rva减去起始rva即可得到相对于起始rva的rva2<br>o<br>5.在区块表中获取该文件中所处的偏移地址（pointertorawdata字段）加上rva2，就得到真正文件偏移地址</p>
</div></article></div><div class="post-nav"><div class="next-wrap col-md-6 col-xs-6 col-md-offset-6 col-xs-offset-6"><a href="/2024/12/01/gype1/" class="next-post">关于PE结构1</a><i class="fa fa-angle-double-right"></i></div></div></main></div><footer><div class="copyright"><p>Crafted with <i class="fa fa-heart"></i> by&nbsp;Hello&nbsp;|&nbsp;<a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yiliashaw/hexo-theme-prince" target="_blank">Prince</a> by SHAW</p></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.0.47/jquery.fancybox.min.js"></script><script src="/js/script.js"></script></body></html>